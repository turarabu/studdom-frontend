{"remainingRequest":"C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\source\\views\\Activity.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\source\\views\\Activity.vue","mtime":1577417158918},{"path":"C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBTZWFyY2hMaXN0IGZyb20gJzpzcmMvY29tcG9uZW50cy9VSS9JbnB1dC9TZWxlY3QudnVlJwppbXBvcnQgRGFpbHlBY3Rpdml0eSBmcm9tICc6c3JjL2NvbXBvbmVudHMvQWN0aXZpdHkvRGFpbHkudnVlJwoKZXhwb3J0IGRlZmF1bHQgewogICAgY29tcG9uZW50czogeyBTZWFyY2hMaXN0LCBEYWlseUFjdGl2aXR5IH0sCiAgICBjb21wdXRlZDogeyBkb3JtaXRvcmllcyB9LAogICAgbWV0aG9kczogeyB1cGRhdGUsIHVwZGF0ZUZpcnN0LCB1cGRhdGVTZWNvbmQgfSwKICAgIG1vdW50ZWQ6IHN0YXJ0LAogICAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0byA9IG5ldyBEYXRlKCkKICAgICAgICB2YXIgZnJvbSA9IG5ldyBEYXRlKCB0byAtICgxMDAwICogNjAgKiA2MCAqIDI0ICogNykgKQogICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHBlcmlvZDogW2Zyb20sIHRvXSwKICAgICAgICAgICAgZGF0ZXBpY2tlcjogZmFsc2UsCiAgICAgICAgICAgIHVzZURvcjogJ3ZrZ3R1JywKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgc2lnblVwczogW10sCiAgICAgICAgICAgICAgICBzaWduSW5zOiBbXQogICAgICAgICAgICB9LAogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gZG9ybWl0b3JpZXMgKCkgewogICAgdmFyIGxpc3QgPSB7fQoKICAgIHRoaXMuJHN0b3JlLnN0YXRlLmRvcm1pdG9yaWVzLmxpc3QuZm9yRWFjaChkb3JtaXRvcnkgPT4gewogICAgICAgIGxpc3RbIGRvcm1pdG9yeS5jb2RlIF0gPSBkb3JtaXRvcnkubmFtZQogICAgfSkKCiAgICByZXR1cm4gbGlzdAp9Cgphc3luYyBmdW5jdGlvbiB1cGRhdGUgKCkgewogICAgdmFyIHsgZGF0YSB9ID0gYXdhaXQgdGhpcy5hcGkuZ2V0KCdyZWNvcmQvcGVyaW9kJywgewogICAgICAgIGZyb206IHRoaXMucGVyaW9kWzBdLAogICAgICAgIHRvOiB0aGlzLnBlcmlvZFsxXSwKICAgICAgICBkb3JtaXRvcnk6IHRoaXMudXNlRG9yCiAgICB9KQoKICAgIHRoaXMuZGF0YSA9IGRhdGEKCiAgICB0aGlzLnVwZGF0ZUZpcnN0KCkKICAgIHRoaXMudXBkYXRlU2Vjb25kKCkKfQoKZnVuY3Rpb24gdXBkYXRlRmlyc3QgKCkgewogICAgdmFyIG1vbnRocyA9IFtdCiAgICB2YXIgc2lnblVwcyA9IDAKICAgIHZhciBzaWduSW5zID0gMAoKICAgIHRoaXMuZGF0YS5zaWduVXBzLmZvckVhY2goc2lnbiA9PiB7CiAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShzaWduLnNpZ25VcCkKICAgICAgICBsZXQgbW9udGggPSBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygncnUnLCB7IG1vbnRoOiAnbG9uZycgfSkKICAgICAgICBsZXQgZGF5ID0gZGF0ZS5nZXREYXkoKQoKICAgICAgICBpZiAoIG1vbnRocy5pbmNsdWRlcyggbW9udGggKSA9PT0gZmFsc2UgKQogICAgICAgICAgICBtb250aHMucHVzaChtb250aCkKCiAgICAgICAgaWYgKCAoZGF5ID09PSAwIHx8IGRheSA9PT0gNikgPT09IGZhbHNlICkKICAgICAgICAgICAgKytzaWduVXBzCiAgICB9KQoKICAgIHRoaXMuZGF0YS5zaWduSW5zLmZvckVhY2goc2lnbiA9PiB7CiAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShzaWduLmRhdGUpLmdldERheSgpCgogICAgICAgIGlmICggKGRhdGUgPT09IDAgfHwgZGF0ZSA9PT0gNikgPT09IGZhbHNlICkKICAgICAgICAgICAgKytzaWduSW5zCiAgICB9KQoKICAgIEhpZ2hjaGFydHMuY2hhcnQoJ2FjdGl2aXR5LTEnLCB7CiAgICAgICAgY2hhcnQ6IHsKICAgICAgICAgICAgcGxvdEJhY2tncm91bmRDb2xvcjogbnVsbCwKICAgICAgICAgICAgcGxvdEJvcmRlcldpZHRoOiBudWxsLAogICAgICAgICAgICBwbG90U2hhZG93OiBmYWxzZSwKICAgICAgICAgICAgdHlwZTogJ3BpZScsCiAgICAgICAgICAgIGhlaWdodDogMzQwCiAgICAgICAgfSwKCiAgICAgICAgY29sb3JzOiBbJyM3Y2I1ZWMnLCAnI2Y3YTM1YycsICcjOTBlZDdkJywgJyM4MDg1ZTknLCAnI2Y0NDIzNiddLAogICAgICAgIHRpdGxlOiB7IHRleHQ6IGAkeyBtb250aHNbMF0gfSAtICR7IG1vbnRoc1swXSB9YCB9LAogICAgICAgIGNyZWRpdHM6IHsgZW5hYmxlZDogZmFsc2UgfSwKICAgICAgICBleHBvcnRpbmc6IHsgYnV0dG9uczogeyBjb250ZXh0QnV0dG9uOiB7IGVuYWJsZWQ6IGZhbHNlIH0gfSB9LAogICAgICAgIHRvb2x0aXA6IHsgcG9pbnRGb3JtYXQ6ICc8Yj57cG9pbnQucGVyY2VudGFnZTouMWZ9JTwvYj4nIH0sCiAgICAgICAgcGxvdE9wdGlvbnM6IHsKICAgICAgICAgICAgcGllOiB7CiAgICAgICAgICAgICAgICBhbGxvd1BvaW50U2VsZWN0OiB0cnVlLAogICAgICAgICAgICAgICAgY3Vyc29yOiAncG9pbnRlcicsCiAgICAgICAgICAgICAgICBzaG93SW5MZWdlbmQ6IHRydWUsCiAgICAgICAgICAgICAgICBkYXRhTGFiZWxzOiB7CiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBmb3JtYXQ6ICd7cG9pbnQucGVyY2VudGFnZTouMWZ9JScsCiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IC01MAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgCiAgICAgICAgc2VyaWVzOiBbewogICAgICAgICAgICBjb2xvckJ5UG9pbnQ6IHRydWUsCiAgICAgICAgICAgIGRhdGE6IFsKICAgICAgICAgICAgICAgIHsgbmFtZTogJ9CQ0LLRgtC+0YDQuNC30LDRhtC40LgnLCB5OiBzaWduSW5zIH0sCiAgICAgICAgICAgICAgICB7IG5hbWU6ICfQoNC10LPQuNGB0YLRgNCw0YbQuNC4JywgeTogc2lnblVwcyB9CiAgICAgICAgICAgIF0KICAgICAgICB9XQogICAgfSkKfQoKZnVuY3Rpb24gdXBkYXRlU2Vjb25kICgpIHsKICAgIHZhciBtb250aHMgPSBbXQogICAgdmFyIHNpZ25VcHMgPSAwCiAgICB2YXIgc2lnbklucyA9IDAKCiAgICB0aGlzLmRhdGEuc2lnblVwcy5mb3JFYWNoKHNpZ24gPT4gewogICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUoc2lnbi5zaWduVXApCiAgICAgICAgbGV0IG1vbnRoID0gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoJ3J1JywgeyBtb250aDogJ2xvbmcnIH0pCiAgICAgICAgbGV0IGRheSA9IGRhdGUuZ2V0RGF5KCkKCiAgICAgICAgaWYgKCBtb250aHMuaW5jbHVkZXMoIG1vbnRoICkgPT09IGZhbHNlICkKICAgICAgICAgICAgbW9udGhzLnB1c2gobW9udGgpCgogICAgICAgIGlmICggZGF0ZSA9PT0gMCB8fCBkYXRlID09PSA2ICkKICAgICAgICAgICAgKytzaWduVXBzCiAgICB9KQoKICAgIHRoaXMuZGF0YS5zaWduSW5zLmZvckVhY2goc2lnbiA9PiB7CiAgICAgICAgbGV0IGRhdGUgPSBuZXcgRGF0ZShzaWduLnNpZ25VcCkuZ2V0RGF5KCkKCiAgICAgICAgaWYgKCBkYXRlID09PSAwIHx8IGRhdGUgPT09IDYgKQogICAgICAgICAgICArK3NpZ25JbnMKICAgIH0pCgogICAgSGlnaGNoYXJ0cy5jaGFydCgnYWN0aXZpdHktMicsIHsKICAgICAgICBjaGFydDogewogICAgICAgICAgICBwbG90QmFja2dyb3VuZENvbG9yOiBudWxsLAogICAgICAgICAgICBwbG90Qm9yZGVyV2lkdGg6IG51bGwsCiAgICAgICAgICAgIHBsb3RTaGFkb3c6IGZhbHNlLAogICAgICAgICAgICB0eXBlOiAncGllJywKICAgICAgICAgICAgaGVpZ2h0OiAzNDAKICAgICAgICB9LAoKICAgICAgICB0aXRsZTogeyB0ZXh0OiBgJHsgbW9udGhzWzBdIH0gLSAkeyBtb250aHNbIG1vbnRocy5sZW5ndGggLSAxIF0gfWAgfSwKICAgICAgICBjcmVkaXRzOiB7IGVuYWJsZWQ6IGZhbHNlIH0sCiAgICAgICAgZXhwb3J0aW5nOiB7IGJ1dHRvbnM6IHsgY29udGV4dEJ1dHRvbjogeyBlbmFibGVkOiBmYWxzZSB9IH0gfSwKICAgICAgICB0b29sdGlwOiB7IHBvaW50Rm9ybWF0OiAnPGI+e3BvaW50LnBlcmNlbnRhZ2U6LjFmfSU8L2I+JyB9LAogICAgICAgIHBsb3RPcHRpb25zOiB7CiAgICAgICAgICAgIHBpZTogewogICAgICAgICAgICAgICAgYWxsb3dQb2ludFNlbGVjdDogdHJ1ZSwKICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLAogICAgICAgICAgICAgICAgc2hvd0luTGVnZW5kOiB0cnVlLAogICAgICAgICAgICAgICAgZGF0YUxhYmVsczogewogICAgICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiAne3BvaW50LnBlcmNlbnRhZ2U6LjFmfSUnLAogICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAtNTAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIAogICAgICAgIHNlcmllczogW3sKICAgICAgICAgICAgY29sb3JCeVBvaW50OiB0cnVlLAogICAgICAgICAgICBkYXRhOiBbCiAgICAgICAgICAgICAgICB7IG5hbWU6ICfQkNCy0YLQvtGA0LjQt9Cw0YbQuNC4JywgeTogc2lnbklucyB9LAogICAgICAgICAgICAgICAgeyBuYW1lOiAn0KDQtdCz0LjRgdGC0YDQsNGG0LjQuCcsIHk6IHNpZ25VcHMgfQogICAgICAgICAgICBdCiAgICAgICAgfV0KICAgIH0pCn0KCmZ1bmN0aW9uIHN0YXJ0ICgpIHsKICAgIHRoaXMudXBkYXRlKCkKICAgIHRoaXMuZGF0ZXBpY2tlciA9ICQoJyNjYWxlbmRhcicpLmRhdGVwaWNrZXIoewogICAgICAgICAgICByYW5nZTogdHJ1ZSwKICAgICAgICAgICAgdG9nZ2xlU2VsZWN0ZWQ6IGZhbHNlLAogICAgICAgICAgICBvblNlbGVjdDogKGEsIGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIGV2ZW50Lmxlbmd0aCA9PT0gMiApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBlcmlvZCA9IGV2ZW50CiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSkKCiAgICB0aGlzLmRhdGVwaWNrZXIuZGF0YSgnZGF0ZXBpY2tlcicpLnNlbGVjdERhdGUodGhpcy5wZXJpb2QpCgogICAgdGhpcy4kd2F0Y2goJ3VzZURvcicsICguLi5hcmcpID0+IHsKICAgICAgICB0aGlzLnVwZGF0ZSgpCiAgICB9KQp9Cg=="},{"version":3,"sources":["Activity.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA","file":"Activity.vue","sourceRoot":"source/views","sourcesContent":["<template lang=\"pug\">\n    div#activity\n        div( class='first-line' )\n            div( class='block' )\n                SearchList( v-bind='{ list: dormitories }' v-model='useDor' )\n                div#calendar\n\n            div( class='block' )\n                h3( class='block-title' ) Активность по будням\n\n                figure( class='highcharts-figure' )\n                    div#activity-1\n\n            div( class='block' )\n                h3( class='block-title' ) Активность по выходным\n\n                figure( class='highcharts-figure' )\n                    div#activity-2\n\n        div( class='second-line' )\n            h3( class='block-title' ) Активность по дням\n            DailyActivity( :data='data' :period='period' )\n\n</template>\n\n<script>\nimport SearchList from ':src/components/UI/Input/Select.vue'\nimport DailyActivity from ':src/components/Activity/Daily.vue'\n\nexport default {\n    components: { SearchList, DailyActivity },\n    computed: { dormitories },\n    methods: { update, updateFirst, updateSecond },\n    mounted: start,\n    data: function () {\n        var to = new Date()\n        var from = new Date( to - (1000 * 60 * 60 * 24 * 7) )\n        \n        return {\n            period: [from, to],\n            datepicker: false,\n            useDor: 'vkgtu',\n            data: {\n                signUps: [],\n                signIns: []\n            },\n        }\n    }\n}\n\nfunction dormitories () {\n    var list = {}\n\n    this.$store.state.dormitories.list.forEach(dormitory => {\n        list[ dormitory.code ] = dormitory.name\n    })\n\n    return list\n}\n\nasync function update () {\n    var { data } = await this.api.get('record/period', {\n        from: this.period[0],\n        to: this.period[1],\n        dormitory: this.useDor\n    })\n\n    this.data = data\n\n    this.updateFirst()\n    this.updateSecond()\n}\n\nfunction updateFirst () {\n    var months = []\n    var signUps = 0\n    var signIns = 0\n\n    this.data.signUps.forEach(sign => {\n        let date = new Date(sign.signUp)\n        let month = date.toLocaleDateString('ru', { month: 'long' })\n        let day = date.getDay()\n\n        if ( months.includes( month ) === false )\n            months.push(month)\n\n        if ( (day === 0 || day === 6) === false )\n            ++signUps\n    })\n\n    this.data.signIns.forEach(sign => {\n        let date = new Date(sign.date).getDay()\n\n        if ( (date === 0 || date === 6) === false )\n            ++signIns\n    })\n\n    Highcharts.chart('activity-1', {\n        chart: {\n            plotBackgroundColor: null,\n            plotBorderWidth: null,\n            plotShadow: false,\n            type: 'pie',\n            height: 340\n        },\n\n        colors: ['#7cb5ec', '#f7a35c', '#90ed7d', '#8085e9', '#f44236'],\n        title: { text: `${ months[0] } - ${ months[0] }` },\n        credits: { enabled: false },\n        exporting: { buttons: { contextButton: { enabled: false } } },\n        tooltip: { pointFormat: '<b>{point.percentage:.1f}%</b>' },\n        plotOptions: {\n            pie: {\n                allowPointSelect: true,\n                cursor: 'pointer',\n                showInLegend: true,\n                dataLabels: {\n                    enabled: true,\n                    format: '{point.percentage:.1f}%',\n                    distance: -50\n                },\n            }\n        },\n        \n        series: [{\n            colorByPoint: true,\n            data: [\n                { name: 'Авторизации', y: signIns },\n                { name: 'Регистрации', y: signUps }\n            ]\n        }]\n    })\n}\n\nfunction updateSecond () {\n    var months = []\n    var signUps = 0\n    var signIns = 0\n\n    this.data.signUps.forEach(sign => {\n        let date = new Date(sign.signUp)\n        let month = date.toLocaleDateString('ru', { month: 'long' })\n        let day = date.getDay()\n\n        if ( months.includes( month ) === false )\n            months.push(month)\n\n        if ( date === 0 || date === 6 )\n            ++signUps\n    })\n\n    this.data.signIns.forEach(sign => {\n        let date = new Date(sign.signUp).getDay()\n\n        if ( date === 0 || date === 6 )\n            ++signIns\n    })\n\n    Highcharts.chart('activity-2', {\n        chart: {\n            plotBackgroundColor: null,\n            plotBorderWidth: null,\n            plotShadow: false,\n            type: 'pie',\n            height: 340\n        },\n\n        title: { text: `${ months[0] } - ${ months[ months.length - 1 ] }` },\n        credits: { enabled: false },\n        exporting: { buttons: { contextButton: { enabled: false } } },\n        tooltip: { pointFormat: '<b>{point.percentage:.1f}%</b>' },\n        plotOptions: {\n            pie: {\n                allowPointSelect: true,\n                cursor: 'pointer',\n                showInLegend: true,\n                dataLabels: {\n                    enabled: true,\n                    format: '{point.percentage:.1f}%',\n                    distance: -50\n                },\n            }\n        },\n        \n        series: [{\n            colorByPoint: true,\n            data: [\n                { name: 'Авторизации', y: signIns },\n                { name: 'Регистрации', y: signUps }\n            ]\n        }]\n    })\n}\n\nfunction start () {\n    this.update()\n    this.datepicker = $('#calendar').datepicker({\n            range: true,\n            toggleSelected: false,\n            onSelect: (a, event) => {\n                if ( event.length === 2 ) {\n                    this.period = event\n                    this.update()\n                }\n            }\n        })\n\n    this.datepicker.data('datepicker').selectDate(this.period)\n\n    this.$watch('useDor', (...arg) => {\n        this.update()\n    })\n}\n</script>\n\n<style lang='stylus'>\n@import '~src/style/palette'\n\n#activity\n\n    .first-line\n        align-items flex-start\n        display flex\n        justify-content space-between\n\n    .second-line\n        margin-top 32px\n\n    .search-list-div\n        min-width 322px\n\n    .block\n        width 320px\n\n    .block-title\n        background lighten($light-gray, 15)\n        color darken($light-gray, 50)\n        border-radius 5px\n        font-size 18px\n        font-weight 400\n        margin-bottom 6px\n        padding 18px 0\n        text-align center\n        text-transform uppercase\n\n    #calendar\n        margin 12px 0\n\n        .datepicker\n            width 100%\n\n        .datepicker--nav\n            font-size 20px\n            font-weight 300\n            padding 8px 4px\n\n        .datepicker--cell\n            margin 6px 0\n\n        .datepicker--cell.-in-range-\n            background RGBA(92, 196, 239, .25)\n        \n@media (min-width: 1600px)\n    #activity\n\n        .block-title\n            font-size 24px\n\n        .search-list-div\n            min-width 382px\n\n        .block\n            width 380px\n\n</style>"]}]}