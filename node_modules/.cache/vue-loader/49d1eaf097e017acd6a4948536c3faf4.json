{"remainingRequest":"C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\source\\views\\Students.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\source\\views\\Students.vue","mtime":1577417605500},{"path":"C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Turar\\Projects\\Work\\studdom\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgQnV0dG9uIGZyb20gJzpzcmMvY29tcG9uZW50cy9VSS9CdXR0b24udnVlJw0KaW1wb3J0IFN3aXRjaGVyIGZyb20gJzpzcmMvY29tcG9uZW50cy9VSS9Td2l0Y2hlci52dWUnDQppbXBvcnQgU2VhcmNoTGlzdCBmcm9tICc6c3JjL2NvbXBvbmVudHMvVUkvU2VhcmNoTGlzdC52dWUnDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgICBuYW1lOiAnU3R1ZGVudHMnLA0KICAgIGNvbXBvbmVudHM6IHsgQnV0dG9uLCBTd2l0Y2hlciwgU2VhcmNoTGlzdCB9LA0KICAgIGNvbXB1dGVkOiB7IHN0dWRlbnRzLCBkb3JtaXRvcmllcywgYWxsLCBzb3J0ZWQgfSwNCiAgICBtZXRob2RzOiB7IHNldFN0YXR1cywgZ2V0RG9ybWl0b3J5LCBnZXRETmFtZXMsIHRvRGF0ZSB9LA0KICAgIGJlZm9yZUNyZWF0ZTogaW5pdCwNCiAgICBtb3VudGVkOiBzdGFydCwNCiAgICBkYXRhOiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBzZWFyY2hCeTogew0KICAgICAgICAgICAgICAgIGRvcm1pdG9yeTogJycsDQogICAgICAgICAgICAgICAgZG9ybWl0b3J5Q29kZTogJycNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gaW5pdCAoKSB7DQogICAgaWYgKCB0aGlzLiRzdG9yZS5zdGF0ZS5zdHVkZW50cy5sb2FkZWQgPT09IGZhbHNlICkNCiAgICAgICAgKGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgIHZhciB7IGRhdGEgfSA9IGF3YWl0IHRoaXMuYXBpLmdldCgnc3R1ZGVudC9hbGwnKQ0KDQogICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3N0dWRlbnRzLXNldCcsIGRhdGEpDQogICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3N0dWRlbnRzLWxvYWRlZCcsIHRydWUpDQogICAgICAgIH0pKCkNCg0KICAgIGlmICggdGhpcy4kc3RvcmUuc3RhdGUuZG9ybWl0b3JpZXMubG9hZGVkID09PSBmYWxzZSApDQogICAgICAgIChhc3luYyAoKSA9PiB7DQogICAgICAgICAgICB2YXIgeyBkYXRhIH0gPSBhd2FpdCB0aGlzLmFwaS5nZXQoJ2Rvcm1pdG9yeS9saXN0JykNCg0KICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdkb3JtaXRvcmllcy1zZXQnLCBkYXRhKQ0KICAgICAgICAgICAgdGhpcy4kc3RvcmUuY29tbWl0KCdkb3JtaXRvcmllcy1sb2FkZWQnLCB0cnVlKQ0KICAgICAgICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKQ0KICAgICAgICB9KSgpDQp9DQoNCmZ1bmN0aW9uIHN0dWRlbnRzICgpIHsNCiAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuc3R1ZGVudHMubGlzdA0KfQ0KDQpmdW5jdGlvbiBkb3JtaXRvcmllcyAoKSB7DQogICAgdmFyIGxpc3QgPSBbXQ0KDQogICAgdGhpcy4kc3RvcmUuc3RhdGUuZG9ybWl0b3JpZXMubGlzdC5mb3JFYWNoKGRvcm1pdG9yeSA9PiB7DQogICAgICAgIGxpc3QucHVzaChkb3JtaXRvcnkpDQogICAgfSkNCg0KICAgIHJldHVybiBsaXN0DQp9DQoNCmZ1bmN0aW9uIHNvcnRlZCAoKSB7DQogICAgdmFyIGxpc3QgPSBbXQ0KDQogICAgaWYgKCB0aGlzLnN0dWRlbnRzICE9IHVuZGVmaW5lZCApDQogICAgICAgIHRoaXMuc3R1ZGVudHMuZm9yRWFjaChzdHVkZW5kID0+IHsNCiAgICAgICAgICAgIGlmICggc3R1ZGVuZC5kb3JtaXRvcnkuc3RhcnRzV2l0aCh0aGlzLnNlYXJjaEJ5LmRvcm1pdG9yeUNvZGUgfHwgJycpICkNCiAgICAgICAgICAgICAgICBsaXN0LnB1c2goc3R1ZGVuZCkNCiAgICAgICAgfSkNCg0KICAgIHJldHVybiBsaXN0DQp9DQoNCmZ1bmN0aW9uIGFsbCAoKSB7DQogICAgdmFyIGNvdW50ID0gMA0KDQogICAgaWYgKCB0aGlzLnNvcnRlZCAhPSB1bmRlZmluZWQgKQ0KICAgICAgICB0aGlzLnNvcnRlZC5mb3JFYWNoKHN0dWRlbmQgPT4gew0KICAgICAgICAgICAgY291bnQgKz0gc3R1ZGVuZC5zaWducw0KICAgICAgICB9KQ0KDQogICAgcmV0dXJuIGNvdW50DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIHNldFN0YXR1cyAoc3R1ZGVudCwgeyB2YWx1ZSwgbG9jayB9KSB7DQogICAgbG9jayh0cnVlKQ0KDQogICAgdmFyIHsgc3VjY2VzcyB9ID0gYXdhaXQgdGhpcy5hcGkucG9zdCgnc3R1ZGVudC9zZXQnLCB7DQogICAgICAgIGlpbjogc3R1ZGVudCwNCiAgICAgICAgYWN0aXZlOiB2YWx1ZQ0KICAgIH0pDQoNCiAgICBpZiAoIHN1Y2Nlc3MgPT09IHRydWUgKSB7DQogICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc3R1ZGVudC11cGRhdGUnLCB7DQogICAgICAgICAgICBpaW46IHN0dWRlbnQsDQogICAgICAgICAgICBhc3NpZ246IHsNCiAgICAgICAgICAgICAgICBhY3RpdmU6IHZhbHVlDQogICAgICAgICAgICB9DQogICAgICAgIH0pDQoNCiAgICAgICAgcmV0dXJuIGxvY2soZmFsc2UpDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBnZXREb3JtaXRvcnkgKGNvZGUpIHsNCiAgICBpZiAoIHRoaXMuZG9ybWl0b3JpZXMgPT0gdW5kZWZpbmVkICkNCiAgICAgICAgcmV0dXJuICcnDQogICAgDQogICAgZm9yICggbGV0IGRvcm1pdG9yeSBvZiB0aGlzLmRvcm1pdG9yaWVzICkgew0KICAgICAgICBpZiAoIGRvcm1pdG9yeS5jb2RlID09PSBjb2RlICkgew0KICAgICAgICAgICAgcmV0dXJuIGRvcm1pdG9yeS5uYW1lDQogICAgICAgIH0NCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGdldEROYW1lcyAoKSB7DQogICAgdmFyIGxpc3QgPSBbXQ0KDQogICAgdGhpcy5kb3JtaXRvcmllcy5mb3JFYWNoKGRvcm1pdG9yeSA9PiB7DQogICAgICAgIGxpc3QucHVzaChkb3JtaXRvcnkubmFtZSkNCiAgICB9KQ0KDQogICAgcmV0dXJuIGxpc3QNCn0NCg0KZnVuY3Rpb24gdG9EYXRlIChzdHJpbmcpIHsNCiAgICByZXR1cm4gbmV3IERhdGUoc3RyaW5nKS50b0xvY2FsZURhdGVTdHJpbmcoJ3J1Jywgew0KICAgICAgICB5ZWFyOiAnbnVtZXJpYycsDQogICAgICAgIGRheTogJ251bWVyaWMnLA0KICAgICAgICBtb250aDogJ2xvbmcnLA0KICAgICAgICBob3VyOiAnbnVtZXJpYycsDQogICAgICAgIG1pbnV0ZTogJ251bWVyaWMnDQogICAgfSkucmVwbGFjZSgnINCzLicsICcnKQ0KfQ0KDQpmdW5jdGlvbiBzdGFydCAoKSB7DQogICAgdGhpcy4kd2F0Y2goJ3NlYXJjaEJ5LmRvcm1pdG9yeScsIG5hbWUgPT4gew0KICAgICAgICBpZiAoIG5hbWUgPT09ICcnICkNCiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlYXJjaEJ5LmRvcm1pdG9yeUNvZGUgPSAnJw0KDQogICAgICAgIGVsc2UgZm9yICggbGV0IGRvcm1pdG9yeSBvZiB0aGlzLmRvcm1pdG9yaWVzICkgew0KICAgICAgICAgICAgaWYgKCBkb3JtaXRvcnkubmFtZSA9PSBuYW1lICkNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2hCeS5kb3JtaXRvcnlDb2RlID0gZG9ybWl0b3J5LmNvZGUNCiAgICAgICAgfQ0KICAgIH0pDQp9DQo="},{"version":3,"sources":["Students.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"Students.vue","sourceRoot":"source/views","sourcesContent":["<template lang=\"pug\">\r\n\r\ndiv#students\r\n\r\n    div( class='controls-div' )\r\n        SearchList( v-bind='{ list: getDNames() }' v-model='searchBy.dormitory' )\r\n\r\n    table( class='all-dormitories' )\r\n        thead( class='not-body head' )\r\n            tr( class='row' )\r\n                th( class='data' ) Полное имя\r\n                th( class='data' ) Общежитие\r\n                th( class='data' ) Регистрация\r\n                th( class='data' ) Активный\r\n                th( class='data' ) Посещений\r\n            \r\n        tbody( class='body' )\r\n            tr( v-for='(student, id) in sorted' class='row' :key='id' )\r\n                td( class='data' ) {{ student.lastName }} {{ student.firstName }}\r\n                td( class='data' ) {{ getDormitory(student.dormitory) }}\r\n                td( class='data' ) {{ toDate(student.signUp) }}\r\n                td( class='data' )\r\n                    Switcher( @input='setStatus(student.iin, $event)' :value='student.active' )\r\n                td( class='data' ) {{ student.signs }}\r\n\r\n        tfoot( class='not-body foot' )\r\n            tr( class='row' )\r\n                th( class='data' colspan='4' ) Всего\r\n                td( class='data' ) {{ all }}\r\n\r\n</template>\r\n\r\n<script>\r\nimport Button from ':src/components/UI/Button.vue'\r\nimport Switcher from ':src/components/UI/Switcher.vue'\r\nimport SearchList from ':src/components/UI/SearchList.vue'\r\n\r\nexport default {\r\n    name: 'Students',\r\n    components: { Button, Switcher, SearchList },\r\n    computed: { students, dormitories, all, sorted },\r\n    methods: { setStatus, getDormitory, getDNames, toDate },\r\n    beforeCreate: init,\r\n    mounted: start,\r\n    data: function () {\r\n        return {\r\n            searchBy: {\r\n                dormitory: '',\r\n                dormitoryCode: ''\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction init () {\r\n    if ( this.$store.state.students.loaded === false )\r\n        (async () => {\r\n            var { data } = await this.api.get('student/all')\r\n\r\n            this.$store.commit('students-set', data)\r\n            this.$store.commit('students-loaded', true)\r\n        })()\r\n\r\n    if ( this.$store.state.dormitories.loaded === false )\r\n        (async () => {\r\n            var { data } = await this.api.get('dormitory/list')\r\n\r\n            this.$store.commit('dormitories-set', data)\r\n            this.$store.commit('dormitories-loaded', true)\r\n            this.$forceUpdate()\r\n        })()\r\n}\r\n\r\nfunction students () {\r\n    return this.$store.state.students.list\r\n}\r\n\r\nfunction dormitories () {\r\n    var list = []\r\n\r\n    this.$store.state.dormitories.list.forEach(dormitory => {\r\n        list.push(dormitory)\r\n    })\r\n\r\n    return list\r\n}\r\n\r\nfunction sorted () {\r\n    var list = []\r\n\r\n    if ( this.students != undefined )\r\n        this.students.forEach(studend => {\r\n            if ( studend.dormitory.startsWith(this.searchBy.dormitoryCode || '') )\r\n                list.push(studend)\r\n        })\r\n\r\n    return list\r\n}\r\n\r\nfunction all () {\r\n    var count = 0\r\n\r\n    if ( this.sorted != undefined )\r\n        this.sorted.forEach(studend => {\r\n            count += studend.signs\r\n        })\r\n\r\n    return count\r\n}\r\n\r\nasync function setStatus (student, { value, lock }) {\r\n    lock(true)\r\n\r\n    var { success } = await this.api.post('student/set', {\r\n        iin: student,\r\n        active: value\r\n    })\r\n\r\n    if ( success === true ) {\r\n        this.$store.commit('student-update', {\r\n            iin: student,\r\n            assign: {\r\n                active: value\r\n            }\r\n        })\r\n\r\n        return lock(false)\r\n    }\r\n}\r\n\r\nfunction getDormitory (code) {\r\n    if ( this.dormitories == undefined )\r\n        return ''\r\n    \r\n    for ( let dormitory of this.dormitories ) {\r\n        if ( dormitory.code === code ) {\r\n            return dormitory.name\r\n        }\r\n    }\r\n}\r\n\r\nfunction getDNames () {\r\n    var list = []\r\n\r\n    this.dormitories.forEach(dormitory => {\r\n        list.push(dormitory.name)\r\n    })\r\n\r\n    return list\r\n}\r\n\r\nfunction toDate (string) {\r\n    return new Date(string).toLocaleDateString('ru', {\r\n        year: 'numeric',\r\n        day: 'numeric',\r\n        month: 'long',\r\n        hour: 'numeric',\r\n        minute: 'numeric'\r\n    }).replace(' г.', '')\r\n}\r\n\r\nfunction start () {\r\n    this.$watch('searchBy.dormitory', name => {\r\n        if ( name === '' )\r\n            return this.searchBy.dormitoryCode = ''\r\n\r\n        else for ( let dormitory of this.dormitories ) {\r\n            if ( dormitory.name == name )\r\n                return this.searchBy.dormitoryCode = dormitory.code\r\n        }\r\n    })\r\n}\r\n</script>\r\n\r\n<style lang='stylus'>\r\n@import '~src/style/palette'\r\n\r\n#students\r\n\r\n    .controls-div \r\n        align-items center\r\n        display flex\r\n        justify-content space-between\r\n\r\n    .all-dormitories\r\n        border-collapse collapse\r\n        margin 42px 0\r\n        width 100%\r\n\r\n        .not-body\r\n            &.head\r\n                border-bottom 1px solid $light-gray\r\n            &.foot\r\n                border-top 1px solid $light-gray\r\n\r\n                .data\r\n                    padding-top 4px\r\n\r\n            .data\r\n                font-weight 500\r\n                padding 8px 12px\r\n\r\n        .body\r\n            &:before, &:after\r\n                content ''\r\n                display block\r\n                height 8px\r\n\r\n            .data:last-child\r\n                font-weight 500\r\n\r\n            .row\r\n                cursor pointer\r\n                &:hover\r\n                    background lighten($light-gray, 25)\r\n\r\n        .data\r\n            font-size 24px   \r\n            padding 4px 12px\r\n            text-align left\r\n            &:last-child\r\n                text-align right\r\n</style>"]}]}